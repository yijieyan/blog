(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{197:function(e,t,n){e.exports=n.p+"assets/img/4.80fa90d1.png"},198:function(e,t,n){e.exports=n.p+"assets/img/5.7ee9f0d8.png"},199:function(e,t,n){e.exports=n.p+"assets/img/6.94cb42ab.png"},200:function(e,t,n){e.exports=n.p+"assets/img/7.b97c8cd7.png"},236:function(e,t,n){"use strict";n.r(t);var s=[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <meta http-equiv="X-UA-Compatible" content="ie=edge">\n  <title>Document</title>\n</head>\n<body>\n  <script>\n    fetch(\'http://localhost:3000/\')\n      .then(res => res.json())\n      .then(data => {\n        console.log(data)\n      })\n      .then((err) => {\n        console.log(`error: ${err}`);\n      })\n  <\/script>\n</body>\n</html>\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("let koa = require('koa');\nlet app =new koa();\n\napp.use(async (ctx, next) => {\n  ctx.body = {code: 0, data: `successful`};\n});\n\napp.listen(3000, () => {\n  console.log(`listen 3000 ...`);\n})\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("准备好实验环境,分别启动对应的server,用浏览器访问结果如下:\n"),t("img",{attrs:{src:n(197),alt:""}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('let koa = require(\'koa\');\nlet app =new koa();\n\napp.use(async (ctx, next) => {\n  ctx.set({\n    "Access-Control-Allow-Origin": "*"\n  });\n  ctx.body = {code: 0, data: `successful`};\n});\n\napp.listen(3000, () => {\n  console.log(`listen 3000 ...`);\n})\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:n(198),alt:""}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("<script>\n  fetch('http://localhost:3000/', {\n      method: 'POST',\n      headers: {\n        'token': '123'\n      }\n    })\n    .then(res => res.json())\n    .then(data => {\n      console.log(data)\n    })\n    .then((err) => {\n      console.log(`error: ${err}`);\n    })\n<\/script>\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:n(199),alt:""}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('app.use(async (ctx, next) => {\n  ctx.set("Access-Control-Allow-Origin","*");\n  ctx.set("Access-Control-Allow-Headers", "token");\n  ctx.body = {code: 0, data: `successful`};\n});\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("再重启服务器,然后刷新页面\n"),t("img",{attrs:{src:n(200),alt:""}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('ctx.set("Access-Control-Allow-Origin","*");\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("------------\nGET\nHEAD\nPOST\n------------\nAccept\nAccept-Language\nContent-Language\nContent-Type （需要注意额外的限制）\nDPR\nDownlink\nSave-Data\nViewport-Width\nWidth\n------------\nContent-Type 的值仅限于下列三者之一：\ntext/plain\nmultipart/form-data\napplication/x-www-form-urlencoded\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('ctx.set("Access-Control-Allow-Origin", "*");\n// 允许所有的域名\nctx.set("Access-Control-Allow-Methods", "OPTIONS, GET, PUT, POST, DELETE");\n// 允许的方法\nctx.set("Access-Control-Allow-Headers", "x-requested-with, accept, origin, content-type");\n// 支持的头信息\n ctx.set("Access-Control-Allow-Credentials", true);\n // 跨域携带cookie,需要保证"Access-Control-Allow-Origin"是服务器有的域名，而不能是"*"\n ctx.set("Access-Control-Max-Age", 300);\n // 设置300s内不用再次进行预请求也就是再发option请求\n')])])])}],a=n(0),r=Object(a.a)({},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("p",[e._v("跨域问题")]),e._v(" "),n("p",[e._v("首先启动2个server,一个代理前端的代码,一个提供api接口\n这里前端我偷懒使用"),n("a",{attrs:{href:"https://www.npmjs.com/package/http-server",target:"_blank",rel:"noopener noreferrer"}},[e._v("http-server"),n("OutboundLink")],1),e._v("这个模块,\n前端写一个简单的ajax请求后端的接口,")]),e._v(" "),n("p",[e._v("前端代码")]),e._v(" "),e._m(0),n("p",[e._v("后端代码")]),e._v(" "),e._m(1),e._m(2),e._v(" "),n("p",[e._v("这是比较经常遇到的跨域问题,解决办法1. 代理 2. 后端处理,为了解决这个问题,修改后端的代码")]),e._v(" "),e._m(3),n("p",[e._v("再起重启服务器,刷新浏览器")]),e._v(" "),e._m(4),e._v(" "),n("p",[e._v("如果把get请求改成post,并且在header里加上个token,结果会怎么样,试一下")]),e._v(" "),n("p",[e._v("修改前端代码:")]),e._v(" "),e._m(5),n("p",[e._v("访问浏览器")]),e._v(" "),e._m(6),e._v(" "),n("p",[e._v("是不是很奇怪,平时我们开发vue等单页应用经常用axios在header里面添加token没报过这个错,\n为什么这里会报错呢")]),e._v(" "),n("p",[e._v("原因:vue使用了webpack里面的"),n("a",{attrs:{href:"https://www.webpackjs.com/configuration/dev-server/#devserver-proxy",target:"_blank",rel:"noopener noreferrer"}},[e._v("devserver-proxy"),n("OutboundLink")],1),e._v(",帮助我们开发的时候后端代理了,如果在2个不同的域名下就会这样。")]),e._v(" "),n("p",[e._v("所以,在一些浏览器允许的字段"),n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS",target:"_blank",rel:"noopener noreferrer"}},[e._v("白名单"),n("OutboundLink")],1),e._v("之外,都是被浏览器视为不安全的,就算设置了跨域,没设置跨域的heder也是会报错的,解决办法,就是在后端添加进去我们要传的头。")]),e._v(" "),n("p",[e._v("修改后端代码")]),e._v(" "),e._m(7),e._m(8),e._v(" "),n("p",[e._v("再服务器设置了")]),e._v(" "),e._m(9),n("p",[e._v("之后,并不是万能的,很多浏览器不允许的字段还是不行的,再浏览器预请求会报错。")]),e._v(" "),n("p",[e._v("浏览器允许的字段有下面这些,具体参照"),n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS",target:"_blank",rel:"noopener noreferrer"}},[e._v("mdn"),n("OutboundLink")],1)]),e._v(" "),e._m(10),n("p",[e._v("不在这里面的都会进行预请求。")]),e._v(" "),n("p",[e._v("参考第三方库,里面一般都包含这几个")]),e._v(" "),e._m(11)])},s,!1,null,null,null);t.default=r.exports}}]);