(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{201:function(t,e,n){t.exports=n.p+"assets/img/2.77dab2f9.png"},202:function(t,e,n){t.exports=n.p+"assets/img/4.0093ec55.png"},203:function(t,e,n){t.exports=n.p+"assets/img/3.781bfe5f.png"},204:function(t,e,n){t.exports=n.p+"assets/img/1.eadaa686.png"},205:function(t,e,n){t.exports=n.p+"assets/img/5.521a01c9.png"},206:function(t,e,n){t.exports=n.p+"assets/img/6.472f5770.png"},225:function(t,e,n){"use strict";n.r(e);var s=[function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_1-http长连接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-http长连接","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.http长连接")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <meta http-equiv="X-UA-Compatible" content="ie=edge">\n  <title>Document</title>\n  <style>\n    img {\n      width: 400px;\n      height: 200px;\n    }\n  </style>\n</head>\n<body>\n  <img src="http://localhost:3000/1.jpg"/>\n</body>\n</html>\n\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("let koa = require('koa');\nlet app =new koa();\nlet fs = require('fs');\nlet path = require('path');\napp.use(async (ctx, next) => {\n  ctx.set('Content-Type', 'image/jpg');\n  ctx.body = fs.createReadStream(path.join(__dirname, './imgs/jinkesi.jpg'));\n});\napp.listen(3000, () => {\n  console.log(`listen 3000 ...`);\n})\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("自己在app.js同级建一个名字为imgs的目录丢进去一张图片,修改一下代码里的图片名称")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ http-server # 自行用npm安装,在这里代理前端的代码\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ node app.js\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(201),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("可以看到response是有一个Connection:keep-alive,表示当前链接,server响应完前端的请求不会立即关闭。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('<img src="http://localhost:3000/1.jpg"/>\n  <img src="http://localhost:3000/2.jpg"/>\n  <img src="http://localhost:3000/3.jpg"/>\n  <img src="http://localhost:3000/4.jpg"/>\n  <img src="http://localhost:3000/5.jpg"/>\n  <img src="http://localhost:3000/6.jpg"/>\n  <img src="http://localhost:3000/7.jpg"/>\n  <img src="http://localhost:3000/8.jpg"/>\n  <img src="http://localhost:3000/9.jpg"/>\n  <img src="http://localhost:3000/10.jpg"/>\n  <img src="http://localhost:3000/11.jpg"/>\n  <img src="http://localhost:3000/12.jpg"/>\n  <img src="http://localhost:3000/13.jpg"/>\n  <img src="http://localhost:3000/14.jpg"/>\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(202),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(203),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("<script>\n  fetch('http://localhost:3000/1.js')\n    .then((res) => {\n        return res.text();\n    }).then(data => {\n      console.log(data);\n    })\n<\/script>\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("let koa = require('koa');\nlet app =new koa();\napp.keys = ['im a newer secret', 'i like turtle'];\napp.use(async (ctx, next) => {\n  ctx.set(\"Access-Control-Allow-Origin\",\"*\");\n  if (ctx.request.url === '/1.js') {\n    ctx.cookies.set('name', 'tobi', {\n      sign: true,\n      maxAge: 10,\n      httpOnly:false\n    });\n    ctx.body = `console.log(\"hello everyone\")`;\n  }\n});\napp.listen(3000, () => {\n  console.log(`listen 3000 ...`);\n})\n\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("table",[n("thead",[n("tr",[n("th",[t._v("参数")]),t._v(" "),n("th",[t._v("value")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("max-age")]),t._v(" "),n("td",[t._v("多少秒后过期")])]),t._v(" "),n("tr",[n("td",[t._v("expires")]),t._v(" "),n("td",[t._v("过期的时间点")])]),t._v(" "),n("tr",[n("td",[t._v("secure")]),t._v(" "),n("td",[t._v("只允许https传输")])]),t._v(" "),n("tr",[n("td",[t._v("domain")]),t._v(" "),n("td",[t._v("设置的域名,设置主域名,子域名也可以使用")])]),t._v(" "),n("tr",[n("td",[t._v("httpOnly")]),t._v(" "),n("td",[t._v("前端js是否允许操作js")])]),t._v(" "),n("tr",[n("td",[t._v("overwrite")]),t._v(" "),n("td",[t._v("是否允许重写")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("如果max-age 和expires 都没有设置会cookie会在会话关闭消失。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(204),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_3-数据协商"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-数据协商","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.数据协商")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(205),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("q=0.9 表示前面的格式代表的权重,权重越大更希望服务器返回权重大的,如果服务器没有,一次往下排。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("span",{staticStyle:{color:"red"}},[this._v("这些是浏览器根据http协议的规范带上去的,至于服务器端会不会也完全遵守http协议？确不一定。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(206),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Cache-Control: private #代理服务器不要缓存\nConnection: Keep-Alive # 长连接\nContent-Type: text/html# 服务器返回的消息的格式，和request里的Accept 对应。\nContent-Encoding: gzip # 是服务器返回的压缩方式。\nVary: Accept-Encoding # 如果 url 和Accept-Encoding 相同才使用代理服务器的缓存,否则不用代理服务器的缓存 (一个请求从浏览器到服务器中间可能经过很多的代理服务器,如果服务器设置了s-max-age,会被代理服务器缓存的,相同的请求可能得到的数据来自代理服务器比如nginx)\n")])])])}],a=n(0),r=Object(a.a)({},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),n("p",[t._v("短连接:在HTTP/1.0中默认使用短连接。也就是说，客户端和服务器每进行一次HTTP操作，就建立一次连接，任务结束就中断连接。")]),t._v(" "),n("p",[t._v("长连接:HTTP/1.1起，默认使用长连接，用以保持连接特性。使用长连接的HTTP协议，会在响应头加入这行代码：")]),t._v(" "),n("p",[t._v("Connection:keep-alive\n在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，客户端再次访问这个服务器时，会继续使用这一条已经建立的连接。Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。实现长连接需要客户端和服务端都支持长连接。")]),t._v(" "),n("p",[t._v("实验代码:\n前端:")]),t._v(" "),t._m(1),n("p",[t._v("后端代码")]),t._v(" "),t._m(2),t._m(3),t._v(" "),n("p",[t._v("运行前端代码")]),t._v(" "),t._m(4),n("p",[t._v("运行后端代码")]),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),t._v(" "),n("p",[t._v("如果多加一些请求,实验环节,多请求一些图片:\n前端代码修改为")]),t._v(" "),t._m(8),n("p",[t._v("通过选择空白出右键勾上Connection ID选项,可以方便的查看请求使用的tcp链接:")]),t._v(" "),t._m(9),t._v(" "),n("p",[t._v("然后访问浏览器查看network:")]),t._v(" "),t._m(10),t._v(" "),n("p",[t._v("通过浏览器的network可以看到不同的请求会重复使用一个tcp链接的,也就是说明connection没有立即关闭。")]),t._v(" "),n("h3",{attrs:{id:"_2-cookie"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-cookie","aria-hidden":"true"}},[t._v("#")]),t._v(" 2."),n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie",target:"_blank",rel:"noopener noreferrer"}},[t._v("cookie"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("实验代码:\n前端:")]),t._v(" "),t._m(11),n("p",[t._v("后端:")]),t._v(" "),t._m(12),n("p",[t._v("cookie 的配置选项:")]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),n("p",[t._v("可以通过设置不同的参数给浏览器。")]),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),n("p",[t._v("数据协商:浏览器 和服务器通信的时候,浏览器会告诉服务器我需要什么格式的数据,我希望是接收什么语言,我能解压哪些压缩格式,压缩的代码。\n举个例子:")]),t._v(" "),t._m(17),t._v(" "),n("p",[t._v("上图中的Accept、Accept-Encoding、Accept-Language 分别告诉浏览器希望接收什么样的消息,什么压缩算法、什么语言。")]),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),n("p",[t._v("再看一张服务器返回(response)的图:")]),t._v(" "),t._m(20),t._v(" "),t._m(21)])},s,!1,null,null,null);e.default=r.exports}}]);