(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{208:function(e,t,a){e.exports=a.p+"assets/img/2.d15ff8f4.png"},209:function(e,t,a){e.exports=a.p+"assets/img/1.2b1041e3.png"},210:function(e,t,a){e.exports=a.p+"assets/img/3.a6c1644c.png"},211:function(e,t,a){e.exports=a.p+"assets/img/4.47a7c6f4.png"},212:function(e,t,a){e.exports=a.p+"assets/img/5.b8bbeff8.png"},223:function(e,t,a){"use strict";a.r(t);var n=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("h3",{attrs:{id:"nginx代理静态页面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx代理静态页面","aria-hidden":"true"}},[e._v("#")]),e._v(" nginx代理静态页面")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ cd /etc/nginx/conf.d/\n$ vim default.conf\n")])])]),n("p",[e._v("修改location")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("location / {\n       root   /opt/app/code; # 修改为你的静态文件的路径\n       index  index.html index.htm;\n   }\n")])])]),n("p",[e._v("保存退出")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ nginx -t  #检查配置有无语法错误\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n\n$ nginx -s reload\n")])])]),n("p",[e._v("在浏览器访问nginx服务器\n"),n("img",{attrs:{src:a(208),alt:""}})]),n("div",{staticStyle:{"text-align":"center"}},[e._v("图1")]),n("p"),e._v(" "),n("h3",[e._v("  nginx代理静态页面的缓存")]),e._v(" "),n("p",[n("img",{attrs:{src:a(209),alt:""}})]),n("div",{staticStyle:{"text-align":"center"}},[e._v("图2")]),e._v(" "),n("img",{attrs:{src:a(210),alt:""}}),e._v(" "),n("div",{staticStyle:{"text-align":"center"}},[e._v("图3")]),n("p"),e._v(" "),n("p",[e._v("和图1比较，ETag和Last-Modified没有改变,服务器决策后返回304")]),e._v(" "),n("blockquote",[n("p",[e._v("配置一下nginx加一个过期时间")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ cd /etc/nginx/conf.d\n$ vim default.conf\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("location / {\n       root   /opt/app/code;\n       expires 2h; #加了一行设置过期时间\n       index  index.html index.htm;\n   }\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ nginx -t\n$ nginx -s reload\n")])])]),n("p",[e._v("再次用浏览器访问\n"),n("img",{attrs:{src:a(211),alt:""}})]),n("div",{staticStyle:{"text-align":"center"}},[e._v("图4")]),n("p"),e._v(" "),n("blockquote",[n("p",[e._v("从图中可以看到多了Cache-Control: max-age=7200, 7200s正好是服务器设置的2h")])]),e._v(" "),n("p",[e._v("note: 刷新页面发现request header中的Cache-Control：max-age=0\n这个属于浏览器的行为,每次刷新页面正常有设置的缓存2h,应该不请求服务器,事实上因为request_header中的max-age=0还是会发一次请求的再让ETag去和服务器比较,决策后返回的还是304")]),e._v(" "),n("h3",{attrs:{id:"设置跨越"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置跨越","aria-hidden":"true"}},[e._v("#")]),e._v(" 设置跨越")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ vim /etc/nginx/conf.d/default.conf\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("location / {\n       root   /opt/app/code;\n       expires 2h;\n       add_header Access-Control-Allow-Origin *;\n       add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;\n       index  index.html index.htm;\n   }\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ nginx -t\n$ nginx -s reload\n")])])]),n("h3",{attrs:{id:"nginx的反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的反向代理","aria-hidden":"true"}},[e._v("#")]),e._v(" nginx的反向代理")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ cd /etc/nginx/conf.d\n$ vim demo.conf\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("server {\n        listen 8000;\n        server_name 112.74.13.145;\n        server_name_in_redirect off;\n        location / {\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_buffering off;\n                proxy_pass http://112.74.13.145:2000;\n                proxy_redirect off;\n        }\n}\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ nginx -t\n$ nginx -s reload\n")])])]),n("p",[e._v("注释:2000是docker容器里的nginx,8000是云主机的nginx(相当于2台服务器)\n通过浏览器访问\n"),n("img",{attrs:{src:a(212),alt:""}})]),e._v(" "),n("h3",{attrs:{id:"_5-配置https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置https","aria-hidden":"true"}},[e._v("#")]),e._v(" 5. 配置https")]),e._v(" "),n("p",[e._v("配置文件如下")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("upstream demo {\n        server 127.0.0.1:3001;#ip,port可以随便修改为合适的ip,port, 这里多写几个可以做负载均衡\n}\n\nserver {\n        listen 443;\n        server_name 192.168.1.2; #服务器的ip\n        ssl on;\n        ssl_certificate /ssl/www/www.crt;#填写具体的文件路径\n        ssl_certificate_key  /ssl/www/www.key;#填写具体的文件路径\n        ssl_session_timeout 5m;\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_prefer_server_ciphers on;\n        server_name_in_redirect off;\n        location / {\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_buffering off;\n                proxy_pass http://demo;\n                proxy_redirect off;\n        }\n}\n")])])])])}],s=a(0),r=Object(s.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);t.default=r.exports}}]);